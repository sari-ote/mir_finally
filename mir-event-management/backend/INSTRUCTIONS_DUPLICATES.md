# הוראות למיזוג כפילויות

## מצב נוכחי
- נמצאו **10,297 קבוצות כפילויות**
- **24,147 מוזמנים כפולים** מתוך 50,228 מוזמנים

## תוכנית פעולה מומלצת

### שלב 1: בדיקה קטנה (10 קבוצות)
```bash
cd mir-event-management\backend
python merge_duplicates.py 4 --limit 10 --execute
```

**מה זה עושה:**
- ממזג רק 10 קבוצות כפילויות ראשונות
- מוחק כ-46 מוזמנים כפולים
- מאפשר לך לבדוק שהכל עובד נכון

**לאחר הבדיקה:**
1. בדוק בדטבייס שהמוזמנים נמחקו נכון
2. בדוק שהמוזמנים שנשמרו עדיין קיימים
3. בדוק שהנתונים נשמרו נכון

### שלב 2: בדיקה בינונית (100 קבוצות)
אם שלב 1 הצליח:
```bash
python merge_duplicates.py 4 --limit 100 --execute
```

### שלב 3: מיזוג מלא
אם הכל עובד טוב:
```bash
python merge_duplicates.py 4 --execute
```

**זה ימזג את כל 10,297 הקבוצות וימחק את כל הכפילויות.**

## מה הסקריפט עושה?

1. **מזהה כפילויות** לפי:
   - תעודת זהות (id_number)
   - שם + טלפון
   - שם + אימייל

2. **שומר את המוזמן הוותיק ביותר** (עם ה-ID הנמוך ביותר)

3. **מוחק את הכפילויות** כולל:
   - רשומות בטבלת guests
   - רשומות קשורות (seatings, greetings, payments, וכו')

4. **מעתיק נתונים** מהמוזמנים שנמחקים למוזמן שנשמר (רק אם השדה ריק)

## אזהרות

⚠️ **גיבוי לפני מיזוג מלא!**
לפני שאתה מריץ את המיזוג המלא, מומלץ מאוד לגבות את הדטבייס!

⚠️ **זהו תהליך בלתי הפיך**
לאחר מחיקת הכפילויות, לא ניתן לשחזר אותן (אלא אם יש גיבוי).

## למה יש כל כך הרבה כפילויות?

הכפילויות נוצרות כי:
- כל ייבוא יוצר מוזמנים חדשים עם TEMP IDs שונים
- אותו מוזמן מיובא מספר פעמים
- הלוגיקה של בדיקת כפילויות בייבוא לא תמיד מזהה כפילויות

**לאחר המיזוג, מומלץ:**
- לבדוק את הלוגיקה של הייבוא
- לוודא שהבדיקת כפילויות עובדת נכון
- למנוע כפילויות בעתיד

## סקריפטים נוספים

### לראות את הכפילויות:
```bash
python find_duplicates.py 4
```

### לראות מה היה קורה (ללא ביצוע):
```bash
python merge_duplicates.py 4
```

